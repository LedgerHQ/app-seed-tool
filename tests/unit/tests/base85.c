#include <stdarg.h>
#include <stdint.h>
#include <stddef.h>
#include <setjmp.h>
#include <cmocka.h>

extern uint8_t base85_encode_64bytes(const uint8_t* src, char* dst);

const uint8_t base85_input[] = {
    0xf7, 0xcf, 0xe5, 0x6f, 0x63, 0xdc, 0xa2, 0x49, 
    0x0f, 0x65, 0xfc, 0xbf, 0x9e, 0xe6, 0x3d, 0xcd, 
    0x85, 0xd1, 0x8f, 0x75, 0x1b, 0x6b, 0x5e, 0x1c, 
    0x1b, 0x87, 0x33, 0xaf, 0x64, 0x59, 0xc9, 0x04, 
    0xa7, 0x5e, 0x82, 0xb4, 0xa2, 0x2e, 0xff, 0xf9, 
    0xb9, 0xe6, 0x9d, 0xe2, 0x14, 0x4b, 0x29, 0x3a, 
    0xa8, 0x71, 0x43, 0x19, 0xa0, 0x54, 0xb6, 0xcb, 
    0x55, 0x82, 0x6a, 0x8e, 0x51, 0x42, 0x52, 0x09
};

const char* encoded_string =
    "_s`{TW89)i4`uwnp5{Hxh0%|78*5%18;3KmWLe1sr(S}zqAvgWx#peX6iX>OsBuFXpj5WYRf1}cQ9@D)";

static void test_base85(void **state) {
    char result[80] = {0};
    uint8_t return_num;

    return_num = base85_encode_64bytes(base85_input, result);

    assert_int_equal(return_num, 80);
    assert_memory_equal(result, encoded_string, sizeof(encoded_string));
}

int main(void) {
    const struct CMUnitTest tests[] = {
        cmocka_unit_test(test_base85)
    };
    return cmocka_run_group_tests(tests, NULL, NULL);
}
